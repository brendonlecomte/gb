#include "memory.h"
#include <string.h>

const uint32_t boot[64] = {
      // 0x31FEFFAF,
      0xAFFFFE31,
      // 0x21FF9F32,
      0x329fff21,
      // 0xCB7C20FB,
      0xFB207CCB,

      // 0x2126FF0E,
      0x0EFF2621,

      // 0x113E8032,
      0X32803E11,

      // 0xE20C3EF3,
      0XF33E0CE2,

      0x773EFCE0,
      0x47110401,
      0x2110801A,
      0xCD9500CD,
      0x9600137B,
      0xFE3220F3,
      0x11D80006,
      0x081A1322,
      0x230520F9,
      0x3E19EA10,
      0x99212F99,
      0x0E0C3D28,
      0x08320D20,
      0xF92E0F18,
      0xF3673E64,
      0x57E0423E,
      0x91E04004,
      0x1E020E0C,
      0xF044FE90,
      0x20FA0D20,
      0xF71D20F2,
      0x0E13247C,
      0x1E83FE62,
      0x28061EC1,
      0xFE642006,
      0x7BE20C3E,
      0x87E2F042,
      0x90E04215,
      0x20D20520,
      0x4F162018,
      0xCBF40604,
      0xC5CB1117,
      0xC1CB1117,
      0x0520F522,
      0x232223C9,
      0xCEED6666,
      0xCC0D000B,
      0x03730083,
      0x000C000D,
      0x0008111F,
      0x8889000E,
      0xDCCC6EE6,
      0xDDDDD999,
      0xBBBB6763,
      0x6E0EECCC,
      0xDDDC999F,
      0xBBB9333E,
      0x3C42B9A5,
      0xB9A5423C,
      0x21040111,
      0xA8001A13,
      0xBE20FE23,
      0x7DFE3420,
      0xF5061978,
      0x86230520,
      0xFB8620FE,
      0x3E01E050
};

// const uint8_t boot[256] = {
      // 0x31, 0xFE, 0xFF, 0x3E, 0x30, 0xE0, 0x00, 0xAF,
      // 0x21, 0xFF, 0x9F, 0x32, 0xCB, 0x7C, 0x20, 0xFB,
      // 0x80, 0xBF, 0xF3, 0xFF, 0xBF, 0xFF, 0x3F, 0x00,
      // 0xFF, 0xBF, 0x7F, 0xFF, 0x9F, 0xFF, 0xBF, 0xFF,
      // 0xFF, 0x00, 0x00, 0xBF, 0x77, 0xF3, 0xF1, 0xFF,
      // 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
      // 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF,
      // 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF,
      // 0x91, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC,
      // 0x00, 0x00, 0x00, 0x00, 0xFF, 0x7E, 0xFF, 0xFE,
      // 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x3E, 0xFF,
      // 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
      // 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
      // 0xC0, 0xFF, 0xC1, 0x00, 0xFE, 0xFF, 0xFF, 0xFF,
      // 0xF8, 0xFF, 0x00, 0x00, 0x00, 0x8F, 0x00, 0x00,
      // 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
      // 0xCE, 0xED, 0x66, 0x66, 0xCC, 0x0D, 0x00, 0x0B,
      // 0x03, 0x73, 0x00, 0x83, 0x00, 0x0C, 0x00, 0x0D,
      // 0x00, 0x08, 0x11, 0x1F, 0x88, 0x89, 0x00, 0x0E, 0xDC, 0xCC, 0x6E, 0xE6,
      // 0xDD, 0xDD, 0xD9, 0x99, 0xBB, 0xBB, 0x67, 0x63, 0x6E, 0x0E, 0xEC, 0xCC,
      // 0xDD, 0xDC, 0x99, 0x9F, 0xBB, 0xB9, 0x33, 0x3E, 0x45, 0xEC, 0x42, 0xFA,
      // 0x08, 0xB7, 0x07, 0x5D, 0x01, 0xF5, 0xC0, 0xFF, 0x08, 0xFC, 0x00, 0xE5,
      // 0x0B, 0xF8, 0xC2, 0xCA, 0xF4, 0xF9, 0x0D, 0x7F, 0x44, 0x6D, 0x19, 0xFE,
      // 0x46, 0x97, 0x33, 0x5E, 0x08, 0xFF, 0xD1, 0xFF, 0xC6, 0x8B, 0x24, 0x74,
      // 0x12, 0xFC, 0x00, 0x9F, 0x94, 0xB7, 0x06, 0xD5, 0x40, 0x7A, 0x20, 0x9E,
      // 0x04, 0x5F, 0x41, 0x2F, 0x3D, 0x77, 0x36, 0x75, 0x81, 0x8A, 0x70, 0x3A,
      // 0x98, 0xD1, 0x71, 0x02, 0x4D, 0x01, 0xC1, 0xFF, 0x0D, 0x00, 0xD3, 0x05,
      // 0xF9, 0x00, 0x0B, 0x00 };


static memory_t _memory;
memory_t *memory = &_memory;

void memory_init(memory_t *mem) {
  memset(mem->memory, 0, FULL_MEMORY);
  memcpy(mem->memory, boot, 256); // init the boot rom into memory_t
  mem->cart = &mem->memory[0];
  mem->vram = &mem->memory[0x8000];
  mem->eram = &mem->memory[0xA000];
  mem->ram = &mem->memory[0xC000];
  mem->oam = &mem->memory[0xFE00];
  mem->io = &mem->memory[0xFF00];
  mem->hram = &mem->memory[0xFF80];
}

uint8_t memory_read8(memory_t *mem, uint16_t addr) { return mem->memory[addr]; }

uint16_t memory_read16(memory_t *mem, uint16_t addr) {
  uint16_t tmp;
  tmp = memory_read8(mem, addr);
  tmp += memory_read8(mem, addr + 1) << 8;
  return tmp;
}

void memory_write8(memory_t *mem, uint16_t addr, uint8_t val) {
  mem->memory[addr] = val;
}

void memory_write16(memory_t *mem, uint16_t addr, uint16_t val) {
  memory_write8(mem, addr +1, (uint8_t)(val >> 8));
  memory_write8(mem, addr, (uint8_t)val & 0xFF);
}
